<div class="plan-list-container">
  <div class="header">
    <h1>–ü–ª–∞–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h1>
    <div class="actions">
      <button class="btn btn-primary" (click)="onUpload()">
        üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω
      </button>
      <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-toggle="dropdown">
          üì• –°–∫–∞—á–∞—Ç—å
        </button>
        <div class="dropdown-menu">
          <a class="dropdown-item" (click)="onDownloadExcel()" href="#">
            üìä Excel (.xlsx)
          </a>
          <a class="dropdown-item" (click)="onDownloadCsv()" href="#">
            üìÑ CSV
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="filters-section">
    <div class="row">
      <div class="col-md-3">
        <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
        <input 
          type="date" 
          id="start_date" 
          class="form-control" 
          [(ngModel)]="filters.start_date"
          (change)="onFilterChange()"
        >
      </div>
      <div class="col-md-3">
        <label for="end_date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
        <input 
          type="date" 
          id="end_date" 
          class="form-control" 
          [(ngModel)]="filters.end_date"
          (change)="onFilterChange()"
        >
      </div>
      <div class="col-md-3">
        <label for="line_id">–õ–∏–Ω–∏—è:</label>
        <select 
          id="line_id" 
          class="form-control" 
          [(ngModel)]="filters.line_id"
          (change)="onFilterChange()"
        >
          <option [ngValue]="undefined">–í—Å–µ –ª–∏–Ω–∏–∏</option>
          <!-- Production lines will be loaded dynamically -->
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-secondary" (click)="clearFilters()">
          ‚ùå –û—á–∏—Å—Ç–∏—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
  <div *ngIf="loading" class="text-center py-4">
    <div class="spinner-border" role="status">
      <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–∞–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞...</p>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞–Ω–æ–≤ -->
  <div *ngIf="!loading && plans.length > 0" class="plans-table">
    <table class="table table-striped table-hover">
      <thead class="thead-dark">
        <tr>
          <th>ID</th>
          <th>–õ–∏–Ω–∏—è</th>
          <th>–ü—Ä–æ–¥—É–∫—Ç</th>
          <th>–ó–∞–¥–∞—á–∞</th>
          <th>–ü–µ—Ä–∏–æ–¥</th>
          <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
          <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
          <th>–°–æ–∑–¥–∞–Ω–æ</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let plan of plans">
          <td>{{ plan.id }}</td>
          <td>{{ plan.line?.name || '‚Äî' }}</td>
          <td>
            <strong>{{ plan.product?.name || '‚Äî' }}</strong>
            <small class="d-block text-muted" *ngIf="plan.product?.code">
              {{ plan.product?.code ?? '‚Äî' }}
            </small>
          </td>
          <td>{{ plan.title }}</td>
          <td>
            <span class="badge badge-info">
              {{ plan.start_dt }} ‚Äî {{ plan.end_dt }}
            </span>
          </td>
          <td>
            <span class="badge badge-secondary">
              {{ getDurationDays(plan.start_dt, plan.end_dt) }} –¥–Ω.
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="{
              'badge-primary': plan.source === 'excel',
              'badge-success': plan.source === 'api',
              'badge-warning': plan.source === 'manual'
            }">
              {{ plan.source }}
            </span>
          </td>
          <td>
            <small class="text-muted">
              {{ plan.created_at | date:'short' }}
            </small>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
  <div *ngIf="!loading && plans.length === 0" class="empty-state text-center py-5">
    <div class="mb-3">
      <i class="fas fa-calendar-alt fa-3x text-muted"></i>
    </div>
    <h3>–ù–µ—Ç –ø–ª–∞–Ω–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h3>
    <p class="text-muted">
      –ü–ª–∞–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º.
    </p>
    <button class="btn btn-primary" (click)="onUpload()">
      üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω
    </button>
  </div>
</div>